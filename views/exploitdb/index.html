{{extend 'layout.html'}}

<div id="table">
    <div id="exploitdbform" class="btn-toolbar">
        <a id="update_db" class="btn btn-small"><i class="icon-refresh"></i> Update Database</a>
        <a id="git_ull" class="btn btn-small"><i class="icon-download"></i> Pull from github</a>
    </div>

    <table cellpadding="0" cellspacing="0" border="0" class="datatable" id="exploitdb_table" width="100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>Description</th>
                <th>Date</th>
                <th>Author</th>
                <th>Platform</th>
                <th>Type</th>
                <th>Port</th>
            </tr>
        </thead>
    </table>

</div>

<script type="text/javascript" language="javascript">

var exploitdb_table;

jQuery(document).ready(function() {

    hosttable = $('#exploitdb_table').dataTable( {
        "bServerSide": true,
        "sAjaxSource": "list.json",
        //"bDeferRender": true,
        "sDom": 'TC<"clear">lfrtip',
        "oTableTools": {
            //"sRowSelect": "multi",
            //"sSelectedClass": "row_selected",
            "sSwfPath": "{{=URL(request.application, 'static', 'TableTools/swf/copy_csv_xls.swf')}}",
        },
        "aaSorting": [[ 2, "desc" ]],
        "aoColumnDefs": [
            { "sSortDataType": "formatted-num", "aTargets": [ 0 ] },
        ],
    } );

    $("#del_host").click( function() {
        $("#delete-modal .modal-title").html('Delete Host(s)');
        var checks = dt_checkboxer_select_DT_RowIds(hosttable);
        if (checks == '')
            $("#delete-modal .modal-body-content").html("No records selected for deletion");
        else
            $("#delete-modal .modal-body-content").html('These items will be permanently deleted and cannot be recovered. This includes all accounts, evidence files, notes, services and vulnerabilities.');
        $("#delete-modal").modal();
    });

    $("#delete-modal .btn-primary").click( function(e) {
        var checks = dt_checkboxer_select_DT_RowIds(hosttable);
        if (checks == '')
            return false;
        var data = "ids=" + checks;
        url = "{{=URL('hosts', 'delete.json', user_signature=True)}}";
        $.web2py.ajax_page( 'POST', url, data, 'undefined' );
    } );

    $.extend( $.fn.dataTableExt.oStdClasses, {
        "sWrapper": "dataTables_wrapper form-inline",
    } );

} );

</script>
